<!doctype html><html lang=en><head><title>duckdb-rs will be the offical duckdb rust client :: Wang Fenjin</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="I will step down as the maintainer of duckdb-rs!"><meta name=keywords content="duckdb,apache-arrow,olap,database,rust,ffi"><meta name=robots content="noodp"><link rel=canonical href=https://www.wangfenjin.com/posts/duckdb-rs-moving-forward-en/><link rel=stylesheet href=https://www.wangfenjin.com/assets/style.css><link rel=stylesheet href=https://www.wangfenjin.com/assets/green.css><link rel=stylesheet href=https://www.wangfenjin.com/style.css><link rel=apple-touch-icon href=https://www.wangfenjin.com/img/apple-touch-icon-192x192.png><link rel="shortcut icon" href=https://www.wangfenjin.com/favicon.ico><meta name=twitter:card content="summary"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="og:title" content="duckdb-rs will be the offical duckdb rust client"><meta property="og:description" content="I will step down as the maintainer of duckdb-rs!"><meta property="og:url" content="https://www.wangfenjin.com/posts/duckdb-rs-moving-forward-en/"><meta property="og:site_name" content="Wang Fenjin"><meta property="og:image" content="https://www.wangfenjin.com/favicon.ico"><meta property="og:image:width" content="2048"><meta property="og:image:height" content="1024"><meta property="article:published_time" content="2023-07-26 00:00:00 +0000 UTC"></head><body class=green><div class="container full headings--one-size"><header class=header><div class=header__inner><div class=header__logo><a href=/><div class=logo>Wang Fenjin's Blog</div></a></div><div class=menu-trigger>menu</div></div><nav class=menu><ul class="menu__inner menu__inner--desktop"><li><a href=/>Home</a></li><li><a href=/about>About</a></li></ul><ul class="menu__inner menu__inner--mobile"><li><a href=/>Home</a></li><li><a href=/about>About</a></li></ul></nav></header><div class=content><div class=post><h1 class=post-title><a href=https://www.wangfenjin.com/posts/duckdb-rs-moving-forward-en/>duckdb-rs will be the offical duckdb rust client</a></h1><div class=post-meta><span class=post-date>2023-07-26</span>
<span class=post-author>:: Wang Fenjin</span></div><span class=post-tags>#<a href=https://www.wangfenjin.com/tags/duckdb/>duckdb</a>&nbsp;
#<a href=https://www.wangfenjin.com/tags/apache-arrow/>apache-arrow</a>&nbsp;
#<a href=https://www.wangfenjin.com/tags/olap/>olap</a>&nbsp;
#<a href=https://www.wangfenjin.com/tags/database/>database</a>&nbsp;
#<a href=https://www.wangfenjin.com/tags/rust/>rust</a>&nbsp;
#<a href=https://www.wangfenjin.com/tags/ffi/>ffi</a>&nbsp;</span><div class=post-content><div><h2 id=background>Background<a href=#background class=hanchor arialabel=Anchor>&#8983;</a></h2><p><a href=https://duckdb.org/>DuckDB</a> is an in-process SQL OLAP database management system implemented in C++. When it was first open-sourced, it was positioned as a columnar database comparable to SQLite, providing the same ease of use. With just a header file and a cpp file, it could be easily embeded in any program, even offering a SQLite-compatible interface, which caught the attention of many people <a href="https://news.ycombinator.com/item?id=24531085">source</a>.</p><p>I started paying attention to DuckDB a long time ago and began writing the first line of <a href=https://github.com/wangfenjin/duckdb-rs>duckdb-rs</a> code on June 7, 2021. About a month later, I wrote a <a href=https://www.wangfenjin.com/posts/duckdb-rs/>blog post</a> introducing the process of building this library, marking the completion of the initial version. Over the past two years, I have released approximately <a href=https://crates.io/crates/duckdb>19 versions</a>, get more than 200 stars in GitHub.</p><p>In the past year, there have been many requirements and ideas for optimization, but I found myself lacking the time, and the number of received issues has been increasing. As a result, I will transfer this library to <a href=https://github.com/duckdb>DuckDB</a> offical organization, believing that make duckdb-rs an official client will lead to further progress and bigger success. Also I&rsquo;d like to take this chance to thanks Mark and Hannes for building DuckDB and agree to accept duckdb-rs as the official rust client.</p><p>This blog post summarizes the main tasks I have undertaken during my maintenance period and points out areas that I believe can be improved.</p><h2 id=key-decisions>Key Decisions<a href=#key-decisions class=hanchor arialabel=Anchor>&#8983;</a></h2><p>This library is the Rust client of DuckDB, so the primary audience interested in this library are users who appreciate DuckDB and use the Rust tech stack. Below are some key factors that I consider contributed to the &ldquo;success&rdquo; of this library:</p><ol><li><p>Initial version based on <a href=https://github.com/rusqlite/rusqlite>rusqlite</a> development. As a Rust beginner myself, I had previously only worked on one Rust project, and this was my second time using Rust. Based on rusqlite, a mature repository, allowed me to quickly obtain a usable version. Additionally, the code structure and API design had already been validated, reducing the likelihood of taking wrong turns. Moreover, the overall code quality could be reasonably assured.</p></li><li><p>Data exchange based on the <a href=https://github.com/apache/arrow-rs>arrow</a> format. Arrow is now considered the columnar storage data exchange standard and is used in many open-source projects. DuckDB has good support for arrow as well. Although DuckDB has its native C interface, using the arrow format for data exchange allows relatively stable interactions between Rust and the C API. This approach ensures that we won&rsquo;t need to make frequent changes due to DuckDB iterations, thus reducing maintenance efforts and minimizing the impact of interface changes on users.</p></li><li><p>Robust CI process. I believe that all open-source projects should strive for this. With a CI process, we can ensure that the code merged into the master branch was error-free. The CI process also included memory leak detection, avoiding potential safety issues introduced by the FFI. The release process was automated as well, with crates being automatically published by tagging.</p></li></ol><h2 id=notable-mrs>Notable MRs<a href=#notable-mrs class=hanchor arialabel=Anchor>&#8983;</a></h2><p>I&rsquo;ve selected a few MRs that I consider significant and that weren&rsquo;t contributed by me:</p><ol><li><p><a href=https://github.com/wangfenjin/duckdb-rs/pull/1>Add github workflow</a>: This was the first MR to add CI checks, which was very meaningful as I used to push directly to master before CI was in place.</p></li><li><p><a href=https://github.com/wangfenjin/duckdb-rs/pull/32>Add r2d2 connection pool</a>: This MR added a connection pool, improving the library&rsquo;s performance.</p></li><li><p><a href=https://github.com/wangfenjin/duckdb-rs/pull/127>Rework bundled compilation to support included extensions</a>: This was the largest MR and allowed the library to support extensions, reworking the logic of bundling DuckDB source code to include various extensions without requiring additional installations.</p></li><li><p><a href=https://github.com/wangfenjin/duckdb-rs/pull/169>Feat: Develop query polars</a>: This MR added support for converting query results into polars data structures. <a href=https://github.com/pola-rs/polars>polars</a> is a popular data processing tool written in Rust. This feature bridged the gap between DuckDB and polars.</p></li></ol><p>Apart from the daily maintenance, I didn&rsquo;t contribute to the development of major features significantly. <a href=https://github.com/wangfenjin/duckdb-rs/pull/138>Support table function</a> can be considered one, and I believe writing extensions in Rust is simpler and safer compared to C/C++.</p><h2 id=outstanding-issues>Outstanding Issues<a href=#outstanding-issues class=hanchor arialabel=Anchor>&#8983;</a></h2><p>Due to limited time and resources, there are still some unresolved issues in this library:</p><ol><li><p>Better documentation. Writing documentation has always been a headache for me since English is not my strong suit. While this library inherited some documentation from rusqlite, it lacks ongoing maintenance, especially regarding documentation specific to DuckDB features. Good documentation and blog posts are key to the success of an open-source project.</p></li><li><p>Support for more data types. There are two categories of data types: those mapped to Rust data types for results, which are not a high priority since arrow-rs already provides comprehensive data types for users working with arrow data. The other category is query parameters, where we need to support a wider range of data types for better user convenience. Currently, we only support some basic query data types.</p></li><li><p>Improved support for data insertion. Columnar databases require the ability to insert data in batches, such as using DuckDB&rsquo;s built-in append interface or supporting insertion of arrow data.</p></li><li><p>Compilation process optimization. As DuckDB&rsquo;s features expand, the compilation process for this library has become slower and resource-consuming, resulting in larger build artifacts.</p></li><li><p>Support for specific DuckDB interfaces, such as streaming query or relation API. These have been raised as issues by some users.</p></li></ol><p>To achieve the same level as DuckDB in terms of documentation and interfaces, there is still much work to be done.</p><h2 id=future-plans>Future Plans<a href=#future-plans class=hanchor arialabel=Anchor>&#8983;</a></h2><p>With the publication of this article, it means I am no longer the maintainer of duckdb-rs. However, this does not mean that I will no longer contribute code to duckdb-rs. I will continue to follow DuckDB and duckdb-rs and contribute code in my spare time.</p><p>If I have time, I may also work on other projects based on duckdb-rs, such as:</p><ul><li>Creating a Rust extension for DuckDB to become a vector database</li><li>Or building a storage server based on duckdb-rs primarily using the <a href=https://github.com/apache/arrow-rs/tree/master/arrow-flight>arrow-flight</a> protocol. If I have even more time, I might add support for Raft to enable distribution. I&rsquo;m not sure how useful these projects would be, but they sound like fun.</li><li>Another possibility is creating a distributed data processing tool, using DuckDB as intermediate data storage or for computation acceleration.</li></ul><hr><blockquote><p>Translated from <a href=https://www.wangfenjin.com/posts/duckdb-rs-moving-forward/>CN Version</a> using ChatGPT and polished manually.</p></blockquote></div></div><div class=pagination><div class=pagination__title><span class=pagination__title-h>Read other posts</span><hr></div><div class=pagination__buttons><span class="button next"><a href=https://www.wangfenjin.com/posts/duckdb-rs-moving-forward/><span class=button__text>duckdb-rs 即将成为 DuckDB 官方 rust 客户端</span>
<span class=button__icon>→</span></a></span></div></div><script src=https://utteranc.es/client.js repo=wangfenjin/wangfenjin.github.io issue-term=pathname label=utteranc.es theme=github-dark crossorigin=anonymous async></script></div></div><footer class=footer><div class=footer__inner><div class="copyright copyright--user"><span>Copyright © 2023 Wang Fenjin :: Powered by <a href=http://gohugo.io>Hugo</a></span>
<span>:: Theme made by <a href=https://twitter.com/panr>panr</a></span></div></div></footer><script src=https://www.wangfenjin.com/assets/main.js></script>
<script src=https://www.wangfenjin.com/assets/prism.js></script></div></body></html>